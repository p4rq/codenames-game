{"ast":null,"code":"import React,{createContext,useState,useContext,useCallback}from'react';import axios from'axios';import{UserContext}from'./UserContext';import{jsx as _jsx}from\"react/jsx-runtime\";export const GameContext=/*#__PURE__*/createContext();// Define API base URL with the /api prefix\nconst API_URL='/api';// Add request/response interceptors for debugging\naxios.interceptors.request.use(config=>{console.log('API Request:',{method:config.method,url:config.url,data:config.data});return config;},error=>{console.error('API Request Error:',error);return Promise.reject(error);});axios.interceptors.response.use(response=>{console.log('API Response:',{status:response.status,data:response.data});return response;},error=>{var _error$response,_error$response2;console.error('API Response Error:',{status:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status,data:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data});return Promise.reject(error);});export const GameProvider=_ref=>{let{children}=_ref;const[game,setGame]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const{user,updateUser}=useContext(UserContext);const clearError=()=>setError(null);// Modify startNewGame to set creator as spectator initially\nconst startNewGame=async(playerId,username)=>{clearError();try{console.log(`Starting new game for player: ${playerId}, ${username}`);const response=await axios.post(`${API_URL}/game/start`,{creator_id:playerId,// Changed from player_id to creator_id\nusername:username});if(response.status===200||response.status===201){console.log(\"Server response:\",response.data);setGame(response.data);// Set the creator as spectator initially\nif(user&&user.id===playerId){updateUser({...user,team:'spectator'});// Also update localStorage\ntry{const userData=JSON.parse(localStorage.getItem('user'));if(userData){userData.team='spectator';localStorage.setItem('user',JSON.stringify(userData));}}catch(e){console.error('Error updating localStorage:',e);}}return response.data;}else{throw new Error(`Failed to start game: ${response.statusText}`);}}catch(err){console.error(\"Error starting game:\",err);setError(`Failed to start game: ${err.message||'Unknown error'}`);return null;}};// Modify joinExistingGame to set joiner as spectator initially\nconst joinExistingGame=async(gameId,userId,username)=>{try{clearError();console.log(\"Joining game as spectator:\",{gameId,userId,username});// Default to spectator team when joining\nconst response=await axios.post(`${API_URL}/game/join`,{game_id:gameId,player_id:userId,username:username,team:'spectator'});console.log(\"Join game response:\",response.data);if(!response.data||!response.data.id){console.error(\"Invalid game response:\",response.data);setError(\"Server returned an invalid game. Please try again.\");return null;}const joinedGame=response.data;setGame(joinedGame);// Set user as spectator in context\nif(user&&user.id===userId){updateUser({...user,team:'spectator'});// Also update localStorage\ntry{const userData=JSON.parse(localStorage.getItem('user'));if(userData){userData.team='spectator';localStorage.setItem('user',JSON.stringify(userData));}}catch(e){console.error('Error updating localStorage:',e);}}return joinedGame;}catch(err){var _err$response;console.error(\"Error joining game:\",err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||'Failed to join game. Please try again.');return null;}};// Other methods like getGameState also need the API prefix\nconst getGameState=async gameId=>{try{clearError();const response=await axios.get(`${API_URL}/game/state?id=${gameId}`);return response.data;}catch(err){var _err$response2;console.error(\"Error fetching game state:\",err);setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data)||'Failed to load game.');return null;}};// Make sure all other API calls use the same prefix\nconst revealCard=async(gameId,cardId,playerId)=>{try{clearError();const response=await axios.post(`${API_URL}/game/reveal`,{game_id:gameId,card_id:cardId,player_id:playerId});return response.data;}catch(err){var _err$response3;console.error(\"Error revealing card:\",err);setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.data)||'Failed to reveal card.');return null;}};const setSpymaster=async(gameId,playerId)=>{try{clearError();const response=await axios.post(`${API_URL}/game/set-spymaster?game_id=${gameId}&player_id=${playerId}`);return response.data;}catch(err){var _err$response4;console.error(\"Error setting spymaster:\",err);setError(((_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.data)||'Failed to become spymaster.');return null;}};const endTurn=async(gameId,playerId)=>{try{clearError();const response=await axios.post(`${API_URL}/game/end-turn?game_id=${gameId}&player_id=${playerId}`);return response.data;}catch(err){var _err$response5;console.error(\"Error ending turn:\",err);setError(((_err$response5=err.response)===null||_err$response5===void 0?void 0:_err$response5.data)||'Failed to end turn.');return null;}};// Update the changeTeam function to immediately update UI\nconst changeTeam=async(gameId,playerId,team)=>{try{// IMPORTANT: First update the user context before API call for immediate UI feedback\nif(user&&user.id===playerId){console.log(`Immediately updating user context with new team: ${team}`);// Update local state right away (don't wait for API)\nupdateUser({...user,team:team});// Update localStorage right away too\ntry{const userData=JSON.parse(localStorage.getItem('user'));if(userData){userData.team=team;localStorage.setItem('user',JSON.stringify(userData));console.log('Updated user in localStorage with new team:',userData);}}catch(e){console.error('Error updating localStorage:',e);}// If we have game state with players, update that too for immediate UI feedback\nif(game&&game.players){const updatedPlayers=game.players.map(player=>player.id===playerId?{...player,team:team}:player);const updatedGame={...game,players:updatedPlayers};setGame(updatedGame);console.log('Updated game state with new team for player');}}// Now make the API call (even if it fails, UI is already updated)\nconsole.log(`API Request: \"/api/game/change-team\"`,{method:'post',url:'/api/game/change-team',data:{game_id:gameId,player_id:playerId,team:team}});const response=await axios.post('/api/game/change-team',{game_id:gameId,player_id:playerId,team:team});// If API call succeeds, update with server response\nif(response.data){setGame(response.data);}return true;}catch(err){console.error(\"Error changing team:\",err);// Even if API call fails, we don't revert the UI change\n// to prevent UI flickering\nreturn false;}};// Set user team both in backend and in user context\nconst setUserTeam=async(gameId,team)=>{if(!user)return null;try{// Update team on server\nconst gameResponse=await changeTeam(gameId,user.id,team);// Force user context update even if server call fails\nupdateUser({...user,team:team});// Also update the user in localStorage for persistence\ntry{const storedUser=JSON.parse(localStorage.getItem('user'));if(storedUser){localStorage.setItem('user',JSON.stringify({...storedUser,team:team}));}}catch(e){console.error(\"Error updating user in localStorage:\",e);}// Also update the game state if server response was successful\nif(gameResponse){setGame(gameResponse);}else{// If server update failed but we still want UI to update, manually update the game state\nif(game&&game.players){const updatedPlayers=game.players.map(p=>p.id===user.id?{...p,team:team}:p);setGame({...game,players:updatedPlayers});}}console.log(`Team changed to ${team} for user ${user.username}`);return true;}catch(error){console.error(\"Error setting user team:\",error);setError(`Failed to change team: ${error.message}`);return false;}};// Fixed handleTeamChange function\nconst handleTeamChange=async(gameId,teamColor)=>{if(!user||!game)return;try{// Update user team on server and in context\nconst updatedUser=await setUserTeam(gameId,teamColor);if(!updatedUser){console.error('Failed to update user team');return;}// Update local game state too\nconst updatedGame={...game};// Find and update the player in the game state\nif(updatedGame.players){const playerIndex=updatedGame.players.findIndex(p=>p.id===user.id);if(playerIndex>=0){updatedGame.players[playerIndex].team=teamColor;setGame(updatedGame);}}console.log(`Team changed to ${teamColor} for user ${user.username}`);}catch(error){console.error('Error changing team:',error);}};// Add this function for setting user as a spectator\nconst setUserSpectator=async gameId=>{if(!user)return null;try{// Update user context to spectator\nupdateUser({...user,team:'spectator'});// Update localStorage for persistence\ntry{const storedUser=JSON.parse(localStorage.getItem('user'));if(storedUser){localStorage.setItem('user',JSON.stringify({...storedUser,team:'spectator'}));}}catch(e){console.error(\"Error updating user in localStorage:\",e);}// API call to set user as spectator\nconst response=await axios.post(`${API_URL}/game/join`,{game_id:gameId,player_id:user.id,username:user.username,team:'spectator'});if(response.data){setGame(response.data);}console.log(`User ${user.username} set as spectator`);return true;}catch(error){console.error(\"Error setting user as spectator:\",error);setError(`Failed to join as spectator: ${error.message}`);return false;}};// Update the provider value with all functions\nreturn/*#__PURE__*/_jsx(GameContext.Provider,{value:{game,setGame,loading,error,clearError,setError,startNewGame,joinExistingGame,getGameState,revealCard,setSpymaster,endTurn,changeTeam,setUserTeam,handleTeamChange,setUserSpectator// Add this new function\n},children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useCallback","axios","UserContext","jsx","_jsx","GameContext","API_URL","interceptors","request","use","config","console","log","method","url","data","error","Promise","reject","response","status","_error$response","_error$response2","GameProvider","_ref","children","game","setGame","loading","setLoading","setError","user","updateUser","clearError","startNewGame","playerId","username","post","creator_id","id","team","userData","JSON","parse","localStorage","getItem","setItem","stringify","e","Error","statusText","err","message","joinExistingGame","gameId","userId","game_id","player_id","joinedGame","_err$response","getGameState","get","_err$response2","revealCard","cardId","card_id","_err$response3","setSpymaster","_err$response4","endTurn","_err$response5","changeTeam","players","updatedPlayers","map","player","updatedGame","setUserTeam","gameResponse","storedUser","p","handleTeamChange","teamColor","updatedUser","playerIndex","findIndex","setUserSpectator","Provider","value"],"sources":["C:/Users/anuarbek/codenames-game/frontend/src/context/GameContext.jsx"],"sourcesContent":["import React, { createContext, useState, useContext, useCallback } from 'react';\r\nimport axios from 'axios';\r\nimport { UserContext } from './UserContext';\r\n\r\nexport const GameContext = createContext();\r\n\r\n// Define API base URL with the /api prefix\r\nconst API_URL = '/api';\r\n\r\n// Add request/response interceptors for debugging\r\naxios.interceptors.request.use(\r\n  config => {\r\n    console.log('API Request:', {\r\n      method: config.method,\r\n      url: config.url,\r\n      data: config.data\r\n    });\r\n    return config;\r\n  },\r\n  error => {\r\n    console.error('API Request Error:', error);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\naxios.interceptors.response.use(\r\n  response => {\r\n    console.log('API Response:', {\r\n      status: response.status,\r\n      data: response.data\r\n    });\r\n    return response;\r\n  },\r\n  error => {\r\n    console.error('API Response Error:', {\r\n      status: error.response?.status,\r\n      data: error.response?.data\r\n    });\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport const GameProvider = ({ children }) => {\r\n  const [game, setGame] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  \r\n  const { user, updateUser } = useContext(UserContext);\r\n\r\n  const clearError = () => setError(null);\r\n\r\n  // Modify startNewGame to set creator as spectator initially\r\n  const startNewGame = async (playerId, username) => {\r\n    clearError();\r\n    \r\n    try {\r\n      console.log(`Starting new game for player: ${playerId}, ${username}`);\r\n      \r\n      const response = await axios.post(`${API_URL}/game/start`, {\r\n        creator_id: playerId,  // Changed from player_id to creator_id\r\n        username: username\r\n      });\r\n      \r\n      if (response.status === 200 || response.status === 201) {\r\n        console.log(\"Server response:\", response.data);\r\n        setGame(response.data);\r\n        \r\n        // Set the creator as spectator initially\r\n        if (user && user.id === playerId) {\r\n          updateUser({\r\n            ...user,\r\n            team: 'spectator'\r\n          });\r\n          \r\n          // Also update localStorage\r\n          try {\r\n            const userData = JSON.parse(localStorage.getItem('user'));\r\n            if (userData) {\r\n              userData.team = 'spectator';\r\n              localStorage.setItem('user', JSON.stringify(userData));\r\n            }\r\n          } catch (e) {\r\n            console.error('Error updating localStorage:', e);\r\n          }\r\n        }\r\n        \r\n        return response.data;\r\n      } else {\r\n        throw new Error(`Failed to start game: ${response.statusText}`);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error starting game:\", err);\r\n      setError(`Failed to start game: ${err.message || 'Unknown error'}`);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Modify joinExistingGame to set joiner as spectator initially\r\n  const joinExistingGame = async (gameId, userId, username) => {\r\n    try {\r\n      clearError();\r\n      console.log(\"Joining game as spectator:\", { gameId, userId, username });\r\n      \r\n      // Default to spectator team when joining\r\n      const response = await axios.post(`${API_URL}/game/join`, {\r\n        game_id: gameId,\r\n        player_id: userId,\r\n        username: username,\r\n        team: 'spectator'\r\n      });\r\n      \r\n      console.log(\"Join game response:\", response.data);\r\n      \r\n      if (!response.data || !response.data.id) {\r\n        console.error(\"Invalid game response:\", response.data);\r\n        setError(\"Server returned an invalid game. Please try again.\");\r\n        return null;\r\n      }\r\n      \r\n      const joinedGame = response.data;\r\n      setGame(joinedGame);\r\n      \r\n      // Set user as spectator in context\r\n      if (user && user.id === userId) {\r\n        updateUser({\r\n          ...user,\r\n          team: 'spectator'\r\n        });\r\n        \r\n        // Also update localStorage\r\n        try {\r\n          const userData = JSON.parse(localStorage.getItem('user'));\r\n          if (userData) {\r\n            userData.team = 'spectator';\r\n            localStorage.setItem('user', JSON.stringify(userData));\r\n          }\r\n        } catch (e) {\r\n          console.error('Error updating localStorage:', e);\r\n        }\r\n      }\r\n      \r\n      return joinedGame;\r\n    } catch (err) {\r\n      console.error(\"Error joining game:\", err);\r\n      setError(err.response?.data || 'Failed to join game. Please try again.');\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Other methods like getGameState also need the API prefix\r\n  const getGameState = async (gameId) => {\r\n    try {\r\n      clearError();\r\n      const response = await axios.get(`${API_URL}/game/state?id=${gameId}`);\r\n      return response.data;\r\n    } catch (err) {\r\n      console.error(\"Error fetching game state:\", err);\r\n      setError(err.response?.data || 'Failed to load game.');\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Make sure all other API calls use the same prefix\r\n  const revealCard = async (gameId, cardId, playerId) => {\r\n    try {\r\n      clearError();\r\n      const response = await axios.post(`${API_URL}/game/reveal`, {\r\n        game_id: gameId,\r\n        card_id: cardId,\r\n        player_id: playerId\r\n      });\r\n      return response.data;\r\n    } catch (err) {\r\n      console.error(\"Error revealing card:\", err);\r\n      setError(err.response?.data || 'Failed to reveal card.');\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const setSpymaster = async (gameId, playerId) => {\r\n    try {\r\n      clearError();\r\n      const response = await axios.post(`${API_URL}/game/set-spymaster?game_id=${gameId}&player_id=${playerId}`);\r\n      return response.data;\r\n    } catch (err) {\r\n      console.error(\"Error setting spymaster:\", err);\r\n      setError(err.response?.data || 'Failed to become spymaster.');\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const endTurn = async (gameId, playerId) => {\r\n    try {\r\n      clearError();\r\n      const response = await axios.post(`${API_URL}/game/end-turn?game_id=${gameId}&player_id=${playerId}`);\r\n      return response.data;\r\n    } catch (err) {\r\n      console.error(\"Error ending turn:\", err);\r\n      setError(err.response?.data || 'Failed to end turn.');\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Update the changeTeam function to immediately update UI\r\n  const changeTeam = async (gameId, playerId, team) => {\r\n    try {\r\n      // IMPORTANT: First update the user context before API call for immediate UI feedback\r\n      if (user && user.id === playerId) {\r\n        console.log(`Immediately updating user context with new team: ${team}`);\r\n        \r\n        // Update local state right away (don't wait for API)\r\n        updateUser({\r\n          ...user,\r\n          team: team\r\n        });\r\n        \r\n        // Update localStorage right away too\r\n        try {\r\n          const userData = JSON.parse(localStorage.getItem('user'));\r\n          if (userData) {\r\n            userData.team = team;\r\n            localStorage.setItem('user', JSON.stringify(userData));\r\n            console.log('Updated user in localStorage with new team:', userData);\r\n          }\r\n        } catch (e) {\r\n          console.error('Error updating localStorage:', e);\r\n        }\r\n        \r\n        // If we have game state with players, update that too for immediate UI feedback\r\n        if (game && game.players) {\r\n          const updatedPlayers = game.players.map(player => \r\n            player.id === playerId \r\n              ? { ...player, team: team } \r\n              : player\r\n          );\r\n          \r\n          const updatedGame = { ...game, players: updatedPlayers };\r\n          setGame(updatedGame);\r\n          console.log('Updated game state with new team for player');\r\n        }\r\n      }\r\n  \r\n      // Now make the API call (even if it fails, UI is already updated)\r\n      console.log(`API Request: \"/api/game/change-team\"`, {\r\n        method: 'post',\r\n        url: '/api/game/change-team',\r\n        data: {\r\n          game_id: gameId,\r\n          player_id: playerId,\r\n          team: team\r\n        }\r\n      });\r\n  \r\n      const response = await axios.post('/api/game/change-team', {\r\n        game_id: gameId,\r\n        player_id: playerId,\r\n        team: team\r\n      });\r\n      \r\n      // If API call succeeds, update with server response\r\n      if (response.data) {\r\n        setGame(response.data);\r\n      }\r\n      \r\n      return true;\r\n    } catch (err) {\r\n      console.error(\"Error changing team:\", err);\r\n      // Even if API call fails, we don't revert the UI change\r\n      // to prevent UI flickering\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Set user team both in backend and in user context\r\n  const setUserTeam = async (gameId, team) => {\r\n    if (!user) return null;\r\n    \r\n    try {\r\n      // Update team on server\r\n      const gameResponse = await changeTeam(gameId, user.id, team);\r\n      \r\n      // Force user context update even if server call fails\r\n      updateUser({ ...user, team: team });\r\n      \r\n      // Also update the user in localStorage for persistence\r\n      try {\r\n        const storedUser = JSON.parse(localStorage.getItem('user'));\r\n        if (storedUser) {\r\n          localStorage.setItem('user', JSON.stringify({ ...storedUser, team: team }));\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Error updating user in localStorage:\", e);\r\n      }\r\n      \r\n      // Also update the game state if server response was successful\r\n      if (gameResponse) {\r\n        setGame(gameResponse);\r\n      } else {\r\n        // If server update failed but we still want UI to update, manually update the game state\r\n        if (game && game.players) {\r\n          const updatedPlayers = game.players.map(p => \r\n            p.id === user.id ? { ...p, team: team } : p\r\n          );\r\n          setGame({ ...game, players: updatedPlayers });\r\n        }\r\n      }\r\n      \r\n      console.log(`Team changed to ${team} for user ${user.username}`);\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Error setting user team:\", error);\r\n      setError(`Failed to change team: ${error.message}`);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Fixed handleTeamChange function\r\n  const handleTeamChange = async (gameId, teamColor) => {\r\n    if (!user || !game) return;\r\n\r\n    try {\r\n      // Update user team on server and in context\r\n      const updatedUser = await setUserTeam(gameId, teamColor);\r\n      \r\n      if (!updatedUser) {\r\n        console.error('Failed to update user team');\r\n        return;\r\n      }\r\n\r\n      // Update local game state too\r\n      const updatedGame = { ...game };\r\n      \r\n      // Find and update the player in the game state\r\n      if (updatedGame.players) {\r\n        const playerIndex = updatedGame.players.findIndex(p => p.id === user.id);\r\n        if (playerIndex >= 0) {\r\n          updatedGame.players[playerIndex].team = teamColor;\r\n          setGame(updatedGame);\r\n        }\r\n      }\r\n      \r\n      console.log(`Team changed to ${teamColor} for user ${user.username}`);\r\n    } catch (error) {\r\n      console.error('Error changing team:', error);\r\n    }\r\n  };\r\n  \r\n  // Add this function for setting user as a spectator\r\n  const setUserSpectator = async (gameId) => {\r\n    if (!user) return null;\r\n    \r\n    try {\r\n      // Update user context to spectator\r\n      updateUser({\r\n        ...user,\r\n        team: 'spectator'\r\n      });\r\n      \r\n      // Update localStorage for persistence\r\n      try {\r\n        const storedUser = JSON.parse(localStorage.getItem('user'));\r\n        if (storedUser) {\r\n          localStorage.setItem('user', JSON.stringify({ ...storedUser, team: 'spectator' }));\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Error updating user in localStorage:\", e);\r\n      }\r\n      \r\n      // API call to set user as spectator\r\n      const response = await axios.post(`${API_URL}/game/join`, {\r\n        game_id: gameId,\r\n        player_id: user.id,\r\n        username: user.username,\r\n        team: 'spectator'\r\n      });\r\n      \r\n      if (response.data) {\r\n        setGame(response.data);\r\n      }\r\n      \r\n      console.log(`User ${user.username} set as spectator`);\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Error setting user as spectator:\", error);\r\n      setError(`Failed to join as spectator: ${error.message}`);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Update the provider value with all functions\r\n  return (\r\n    <GameContext.Provider \r\n      value={{ \r\n        game, \r\n        setGame,\r\n        loading,\r\n        error, \r\n        clearError,\r\n        setError,\r\n        startNewGame, \r\n        joinExistingGame,\r\n        getGameState, \r\n        revealCard, \r\n        setSpymaster, \r\n        endTurn,\r\n        changeTeam,\r\n        setUserTeam,\r\n        handleTeamChange,\r\n        setUserSpectator  // Add this new function\r\n      }}\r\n    >\r\n      {children}\r\n    </GameContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}